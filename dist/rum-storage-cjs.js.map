{"version":3,"file":"rum-storage-cjs.js","sources":["../src/index.js"],"sourcesContent":["export const STORAGE_DEFAULTS = {\n  index: 'sid',\n  indexDelimiter: '-'\n}\n\nexport const NOT_FOUND = 404\nexport const METHOD_NOT_ALLOWED = 405\n\nexport class Storage {\n  constructor(opts) {\n    Object.assign(this, STORAGE_DEFAULTS, opts)\n    this._init()\n  }\n\n  _init() {\n    this._cache = {}\n  }\n\n  indexIn(record) {\n    if (typeof this.index === \"string\") return record[this.index]\n    if (Array.isArray(this.index)) {\n      let index = []\n      for (let p of this.index) index.push(record[p])\n      return index.join(this.indexDelimiter)\n    }\n  }\n\n\n  insert(record) {\n    const index = this.indexIn(record)\n    return new Promise((resolve, reject)=>{\n      if (!this._cache.hasOwnProperty(index)) {\n        this._cache[index] = record\n        resolve(this._cache[index])\n      } else reject(METHOD_NOT_ALLOWED)\n    })\n  }\n\n  list() {\n    return new Promise((resolve, reject)=>{\n      resolve(Object.keys(this._cache))\n    })\n  }\n\n  find(recordOrIndex) {\n    let index\n    if (typeof recordOrIndex === \"string\") index = recordOrIndex\n    else index = this.indexIn(recordOrIndex)\n    return new Promise((resolve, reject)=>{\n      if (this._cache.hasOwnProperty(index)) {\n        resolve(this._cache[index])\n      } else reject(NOT_FOUND)\n    })\n  }\n\n  update(record) {\n    const index = this.indexIn(record)\n    return new Promise((resolve, reject)=>{\n      if (this._cache.hasOwnProperty(index)) {\n        Object.assign(this._cache[index], record)\n        resolve(this._cache[index])\n      } else reject(NOT_FOUND)\n    })\n  }\n\n  upsert(record) {\n    const index = this.indexIn(record)\n    if (this._cache.hasOwnProperty(index)) return this.update(record)\n    return this.insert(record)\n  }\n\n  replace(record) {\n    const index = this.indexIn(record)\n    return new Promise((resolve, reject)=>{\n      if (this._cache.hasOwnProperty(index)) {\n        this._cache[index] = record\n        resolve(this._cache[index])\n      } else reject(NOT_FOUND)\n    })\n  }\n\n  remove(recordOrIndex) {\n    let index\n    if (typeof recordOrIndex === \"string\") index = recordOrIndex\n    else index = this.indexIn(recordOrIndex)\n    return new Promise((resolve, reject)=>{\n      if (this._cache.hasOwnProperty(index)) {\n        let deleted = this._cache[index]\n        delete this._cache[index]\n        resolve(deleted)\n      } else reject(NOT_FOUND)\n    })\n  }\n}\n"],"names":["STORAGE_DEFAULTS","index","indexDelimiter","NOT_FOUND","METHOD_NOT_ALLOWED","Storage","opts","Object","assign","_init","_cache","record","Array","isArray","p","push","join","indexIn","Promise","resolve","reject","hasOwnProperty","keys","recordOrIndex","update","insert","deleted"],"mappings":"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"}